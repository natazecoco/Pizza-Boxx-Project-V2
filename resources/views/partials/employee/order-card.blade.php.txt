<div x-data="{ open: false }" class="bg-white p-5 rounded-xl shadow-md transition-all duration-300 transform hover:scale-[1.01] border border-gray-100">
    <div class="flex items-center justify-between cursor-pointer" @click="open = !open">
        <div class="flex-grow">
            <h3 class="text-lg font-bold text-gray-800">#{{ $order->id }} - {{ $order->customer_name }}</h3>
            
            <div class="flex items-center gap-2 mt-1">
                <p class="text-sm text-gray-500">
                    <i class="far fa-clock mr-1"></i> {{ $order->created_at->format('H:i') }}
                </p>
                
                @php
                    $diff = $order->created_at->diff(now());
                    $parts = [];
                    if ($diff->h > 0) $parts[] = $diff->h . ' jam';
                    if ($diff->i > 0) $parts[] = $diff->i . ' mnt';
                    $parts[] = $diff->s . ' dtk';
                    $timeLabel = implode(', ', $parts);

                    $totalMinutes = $order->created_at->diffInMinutes(now());
                    $isUrgent = ($totalMinutes >= 20 && in_array($order->status, ['pending', 'accepted', 'preparing']));
                @endphp

                <span class="text-[10px] px-2 py-0.5 rounded font-bold uppercase tracking-wider
                    @if($isUrgent) bg-red-600 text-white animate-pulse @else bg-gray-100 text-gray-500 @endif">
                    {{ $timeLabel }}
                </span>
            </div>
        </div>

        <div class="flex-shrink-0">
            <span class="inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest
                @if($order->status == 'pending') bg-yellow-100 text-yellow-700
                @elseif($order->status == 'accepted' || $order->status == 'preparing') bg-blue-100 text-blue-700
                @elseif($order->status == 'ready_for_delivery') bg-green-100 text-green-700
                @elseif($order->status == 'on_delivery') bg-purple-100 text-purple-700
                @else bg-gray-200 text-gray-600 @endif">
                {{ str_replace('_', ' ', $order->status) }}
            </span>
        </div>
    </div>

    <div class="mt-4 p-3 bg-gray-50 rounded-lg border border-dashed border-gray-300">
        <h4 class="text-xs font-bold text-gray-400 uppercase mb-2 tracking-widest">Daftar Pesanan:</h4>
        <ul class="space-y-2">
            @foreach($order->orderItems as $item)
                <li class="text-sm text-gray-700 flex justify-between items-start">
                    <div class="flex gap-2">
                        <span class="font-bold text-red-600">{{ $item->quantity }}x</span>
                        <div>
                            <p class="font-semibold leading-none">{{ $item->product_name }}</p>
                            {{-- Tampilkan Topping/Size jika ada --}}
                            @if($item->options)
                                <p class="text-[11px] text-gray-500 mt-1 italic">
                                    {{ is_array($item->options) ? implode(', ', $item->options) : $item->options }}
                                </p>
                            @endif
                        </div>
                    </div>
                </li>
            @endforeach
        </ul>
    </div>
    
    <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-100">
        <p class="text-xs font-bold text-gray-400 italic">{{ ucfirst($order->order_type) }}</p>
        
        <div class="flex gap-2">
             {{-- Gunakan logika tombol yang sudah kita buat sebelumnya --}}
             @if($order->status == 'pending')
                <form action="{{ route('pegawai.orders.update-status', $order->id) }}" method="POST">
                    @csrf
                    <input type="hidden" name="status" value="accepted">
                    <button type="submit" class="text-xs bg-red-600 text-white px-3 py-1.5 rounded-lg font-bold hover:bg-red-700 transition-colors">
                        Terima
                    </button>
                </form>
            @endif
            <a href="{{ route('pegawai.orders.index', ['order_id' => $order->id]) }}" class="text-xs bg-gray-100 text-gray-600 px-3 py-1.5 rounded-lg font-bold hover:bg-gray-200 transition-colors">
                Detail
            </a>
        </div>
    </div>
</div>